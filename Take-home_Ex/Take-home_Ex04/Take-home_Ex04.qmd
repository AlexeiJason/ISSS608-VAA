---
title: "Take-home Exercise 4: Prototyping Modules for Visual Analytics Shiny Application"
author: "Alexei Jason"
date: "February 28, 2024"
date-modified: "last-modified"
execute: 
  eval: true
  echo: true
  warning: false
editor: visual
---

# Data Preparation

## Importing packages

```{r}
pacman::p_load(tidyverse, patchwork, readr, dplyr,ggiraph,forecast, plotly)
```

## Importing Datasets

```{r}
CPI_data = read.csv ("data/CPISingapore.csv")

head(CPI_data)
```

## Consumer Price Index (CPI), 2019 As Base Year, Annual

```{r}
point_desc <- c(paste0(
  "Variable: ", CPI_data$Variable,
  "\nYear: ",CPI_data$Year,
  "\nPrice Index: ", CPI_data$CPI))

line <- ggplot(data = CPI_data,
               aes(x = Year, y = CPI,
                   group = Variable,
                   color = Variable,
                   data_id = Variable)) +
  geom_line_interactive(size = 0.5) +
  geom_point_interactive(aes(tooltip = point_desc),
                         fill = "grey90",
                         size = 1,
                         stroke = 1,
                         shape = 21) +
 
  labs(y = "Consumer Price Index ",
       x = "Year",
       title = "Consumer Price Index (CPI), 2019 As Base Year, Annual")

girafe(ggobj = line, 
       width_svg = 10,
       height_svg = 5 ,
       options = list(
         opts_hover(css = "stroke-width: 1; opacity: 1;"),
         opts_hover_inv(css = "stroke-width: 1;opacity:0.1;")))
```

The weighting pattern of the Consumer Price Index (CPI) was derived from the expenditure values collected from the 2017/18 Household Expenditure Survey (HES) and updated to 2019 values by taking into account price changes between 2017/18 and 2019.

Prior to 2019, data pertain to taxi services only. From 2019 onwards, data pertain to taxi and private hire car services.

Accommodation, one of the groups in the Housing & Utilities expenditure division of the CPI, comprises 'rented and owner-occupied accommodation', as well as 'housing maintenance & repairs'. A significant share of the Accommodation group is 'owner-occupied accommodation (OOA)' cost, which is meant to reflect the costs to homeowners of utilising the flow of services provided by their homes over an extended period of time. As the cost of using housing services is not directly observed for homeowners, it is computed based on the imputed rental concept under the rental equivalence method, i.e. proxied by market rentals. Imputed rentals on OOA have no impact on the cash expenditure of owner-occupied households. For “All Items less imputed rentals on owner-occupied accommodation”, actual rentals paid on rented homes are still included in this measure.

### Forecast

```{r}
CPI_fc <- filter(CPI_data, Variable == "All Items")

CPI_fc$Year <- as.numeric(CPI_fc$Year)
CPI_fc$CPI <- as.numeric(CPI_fc$CPI)


CPI_ts <- ts(CPI_fc$CPI, start = min(CPI_data$Year), end = max(CPI_data$Year), frequency = 1)
                    


arima_model <- auto.arima(CPI_ts)


forecast_values <- forecast(arima_model, h = 5)


plot_data <- data.frame(Year = c(time(CPI_ts), time(forecast_values$mean)),
                        CPI = c(CPI_ts, forecast_values$mean),
                        Variable = rep(c("Actual", "Forecast"), c(length(CPI_ts), length(forecast_values$mean))))


plot_ly(plot_data, x = ~Year, y = ~CPI, color = ~Variable, type = 'scatter', mode = 'lines') %>%
  layout(title = "Total Expenditure Forecast",
         xaxis = list(title = "Year"),
         yaxis = list(title = "Expenditure"))
```

```{r}

```
